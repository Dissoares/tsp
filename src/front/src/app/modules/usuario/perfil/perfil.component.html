<app-cabecalho> </app-cabecalho>
<mat-toolbar class="breadcrumbs">
  <mat-card-header>
    <mat-card-title><mat-icon>account_circle</mat-icon>{{ ehEdicao ? 'Alterar senha' : 'Perfil' }}</mat-card-title>
  </mat-card-header>
</mat-toolbar>

<div class="auth-form">
  <mat-card><mat-card-content>
      <form [formGroup]="formulario" class="container">
        @if (!ehEdicao) {
        <mat-form-field appearance="outline" class="field-12">
          <mat-label>Nome</mat-label>
          <mat-icon matPrefix>account_circle</mat-icon>
          <input matInput formControlName="nome" />
        </mat-form-field>

        <mat-form-field appearance="outline" class="field-12">
          <mat-label>E-mail</mat-label>
          <mat-icon matPrefix>alternate_email</mat-icon>
          <input matInput type="email" formControlName="email" />
        </mat-form-field>

        <mat-form-field appearance="outline" class="field-12">
          <mat-label>Perfil</mat-label>
          <mat-icon matPrefix>shield_lock</mat-icon>
          <mat-select formControlName="perfil">
            <mat-option *ngFor="let perfil of listaPerfilEnum" [value]="perfil.id">
              {{ perfil.descricao }}
            </mat-option>
          </mat-select>
        </mat-form-field>

        <mat-form-field appearance="outline" class="field-12">
          <mat-label>Data Cadastro</mat-label>
          <mat-icon matPrefix>calendar_month</mat-icon>
          <input matInput type="text" formControlName="dataCriacao" />
        </mat-form-field>

        <div class="imagem-perfil-section field-12">
          <mat-label class="section-title">Imagem de Perfil</mat-label>

          <div class="imagem-container">
            @if (visualizacaoImagem || linkImagem) {
            <img [src]="visualizacaoImagem || linkImagem" alt="Imagem de perfil" class="imagem-preview" />
            } @else {
            <div class="sem-imagem-circle" (click)="fileInput.click()">
              <mat-icon>add_a_photo</mat-icon>
            </div>
            }

            @if (progressoUpload) {
            <div class="upload-overlay">
              <mat-progress-spinner mode="indeterminate" diameter="40"></mat-progress-spinner>
            </div>
            }
          </div>

          <div class="imagem-actions">
            <input type="file" #fileInput hidden accept="image/*" (change)="onFileSelected($event)" />

            @if (!ehEdicao) {
            <button mat-stroked-button type="button" (click)="editarDadosPerfil()">
              <mat-icon>edit</mat-icon>
              Editar Perfil
            </button>
            }

            @if (ehEdicao || visualizacaoImagem || linkImagem) {
            <button mat-stroked-button type="button" (click)="fileInput.click()" [disabled]="progressoUpload">
              <mat-icon>upload</mat-icon>
              {{ linkImagem ? 'Alterar Imagem' : 'Adicionar Imagem' }}
            </button>

            @if (visualizacaoImagem) {
            <button mat-stroked-button type="button" (click)="cancelarUpload()" [disabled]="progressoUpload">
              <mat-icon>cancel</mat-icon>
              Cancelar
            </button>
            }

            @if (linkImagem && !visualizacaoImagem) {
            <button mat-stroked-button color="warn" type="button" (click)="removerImagem()" [disabled]="progressoUpload">
              <mat-icon>delete</mat-icon>
              Remover Imagem
            </button>
            }
            }
          </div>
        </div>
        }
        @if (ehEdicao) {
        <mat-form-field appearance="outline" floatLabel="always" class="field-12">
          <mat-label>Senha</mat-label>
          <mat-icon matPrefix>lock</mat-icon>
          <input matInput [type]="mostrarSenha ? 'text' : 'password'" formControlName="senha"
            placeholder="Digite a nova senha" />
          <button mat-icon-button matSuffix (click)="mostrarSenha = !mostrarSenha" type="button">
            <mat-icon>{{ mostrarSenha ? 'visibility_off' : 'visibility' }}</mat-icon>
          </button>
          <mat-error>
            <app-erro [dadosCampo]="formulario.get('senha')"></app-erro>
          </mat-error>
        </mat-form-field>

        <mat-form-field appearance="outline" floatLabel="always" class="field-12">
          <mat-label>Repita Senha</mat-label>
          <mat-icon matPrefix>lock</mat-icon>
          <input matInput [type]="mostrarConfirmarSenha ? 'text' : 'password'" formControlName="confirmarSenha"
            placeholder="Repita a nova senha" />
          <button mat-icon-button matSuffix (click)="mostrarConfirmarSenha = !mostrarConfirmarSenha" type="button">
            <mat-icon>{{ mostrarConfirmarSenha ? 'visibility_off' : 'visibility' }}</mat-icon>
          </button>
          <mat-error>
            <app-erro [dadosCampo]="formulario.get('confirmarSenha')"></app-erro>
          </mat-error>
        </mat-form-field>
        }

        @if (ehEdicao) {
        <mat-card-footer>
          <button class="salvar" type="submit" mat-flat-button (click)="alterarSenha()">
            Salvar
            <mat-icon>arrow_forward</mat-icon>
          </button>
          <button class="cancelar" type="submit" mat-flat-button (click)="cancelar()">
            Cancelar
            <mat-icon>arrow_forward</mat-icon>
          </button>
        </mat-card-footer>
        }
      </form>
    </mat-card-content>
  </mat-card>
</div>
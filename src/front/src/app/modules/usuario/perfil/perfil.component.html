<app-cabecalho> </app-cabecalho>
<mat-toolbar class="breadcrumbs">
  <mat-card-header>
    <mat-card-title><mat-icon>account_circle</mat-icon>{{ ehEdicao ? 'Alterar senha' : 'Perfil' }}</mat-card-title>
  </mat-card-header>
</mat-toolbar>

<div class="auth-form">
  <mat-card>
    <mat-card-content>
      @if (!ehEdicaoSenha) {
      <div class="secao-imagem-perfil field-12">
        <mat-label class="titulo-secao">Imagem de Perfil</mat-label>

        <div class="container-imagem">
          @if (visualizacaoImagem || linkImagem) {
          <img [src]="visualizacaoImagem || linkImagem" alt="Imagem de perfil" class="previsualizacao-imagem" />
          } @else {
          <div class="sem-imagem-circulo" (click)="fileInput.click()"
            matTooltip="Clique para adicionar uma imagem de perfil" matTooltipPosition="right">
            <mat-icon>add_a_photo</mat-icon>
          </div>
          }

          @if (progressoUpload) {
          <div class="sobreposicao-upload">
            <mat-progress-spinner mode="indeterminate" diameter="40"></mat-progress-spinner>
          </div>
          }
        </div>

        <div class="acoes-imagem">
          <input type="file" #fileInput hidden accept="image/*" (change)="onFileSelected($event)" />

          @if (ehEdicao || visualizacaoImagem || linkImagem) {
          <button mat-stroked-button type="button" (click)="fileInput.click()" [disabled]="progressoUpload"
            class="cancelar">
            <mat-icon>upload</mat-icon>
            {{ linkImagem ? 'Alterar' : 'Adicionar' }}
          </button>

          @if (visualizacaoImagem) {
          <button mat-stroked-button type="button" (click)="cancelarUpload()" [disabled]="progressoUpload"
            class="cancelar">
            <mat-icon>cancel</mat-icon>
            Cancelar
          </button>
          }

          @if (linkImagem && !visualizacaoImagem) {
          <button mat-stroked-button color="warn" type="button" (click)="removerImagem()" [disabled]="progressoUpload"
            class="cancelar">
            <mat-icon>delete</mat-icon>
            Remover
          </button>
          }
          }
        </div>
      </div>
      }
      <form [formGroup]="formulario" class="container">
        @if (!ehEdicao) {
        <mat-form-field appearance="outline" class="field-12">
          <mat-label>Nome</mat-label>
          <mat-icon matPrefix>account_circle</mat-icon>
          <input matInput formControlName="nome" />
        </mat-form-field>

        <mat-form-field appearance="outline" class="field-12">
          <mat-label>E-mail</mat-label>
          <mat-icon matPrefix>alternate_email</mat-icon>
          <input matInput type="email" formControlName="email" />
        </mat-form-field>

        <mat-form-field appearance="outline" class="field-12">
          <mat-label>Perfil</mat-label>
          <mat-icon matPrefix>shield_lock</mat-icon>
          <mat-select formControlName="perfil">
            <mat-option *ngFor="let perfil of listaPerfilEnum" [value]="perfil.id">
              {{ perfil.descricao }}
            </mat-option>
          </mat-select>
        </mat-form-field>

        <mat-form-field appearance="outline" class="field-12">
          <mat-label>Data Cadastro</mat-label>
          <mat-icon matPrefix>calendar_month</mat-icon>
          <input matInput type="text" formControlName="dataCriacao" />
        </mat-form-field>

        <button mat-stroked-button type="button" (click)="editarDadosPerfil()" class="field-12 alterar-senha">
          <mat-icon>edit</mat-icon>
          Alterar senha
        </button>
        }
        @if (ehEdicao && !visualizacaoImagem) {
        <mat-form-field appearance="outline" floatLabel="always" class="field-12">
          <mat-label>Senha</mat-label>
          <mat-icon matPrefix>lock</mat-icon>
          <input matInput [type]="mostrarSenha ? 'text' : 'password'" formControlName="senha"
            placeholder="Digite a nova senha" />
          <button mat-icon-button matSuffix (click)="mostrarSenha = !mostrarSenha" type="button">
            <mat-icon>{{ mostrarSenha ? 'visibility_off' : 'visibility' }}</mat-icon>
          </button>
          <mat-error>
            <app-erro [dadosCampo]="formulario.get('senha')"></app-erro>
          </mat-error>
        </mat-form-field>

        <mat-form-field appearance="outline" floatLabel="always" class="field-12">
          <mat-label>Repita Senha</mat-label>
          <mat-icon matPrefix>lock</mat-icon>
          <input matInput [type]="mostrarConfirmarSenha ? 'text' : 'password'" formControlName="confirmarSenha"
            placeholder="Repita a nova senha" />
          <button mat-icon-button matSuffix (click)="mostrarConfirmarSenha = !mostrarConfirmarSenha" type="button">
            <mat-icon>{{ mostrarConfirmarSenha ? 'visibility_off' : 'visibility' }}</mat-icon>
          </button>
          <mat-error>
            <app-erro [dadosCampo]="formulario.get('confirmarSenha')"></app-erro>
          </mat-error>
        </mat-form-field>
        }

        @if (ehEdicao && !visualizacaoImagem) {
        <mat-card-footer>
          <button class="salvar" type="submit" mat-flat-button (click)="alterarSenha()">
            Salvar
            <mat-icon>arrow_forward</mat-icon>
          </button>
          <button class="cancelar" type="submit" mat-flat-button (click)="cancelar()">
            Cancelar
            <mat-icon>arrow_forward</mat-icon>
          </button>
        </mat-card-footer>
        }
      </form>
    </mat-card-content>
  </mat-card>
</div>